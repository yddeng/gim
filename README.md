# chat

游戏中的聊天服务器

## 对话类型

### 聊天室 

如世界频道

- 群聊人数非常多，群人员上限无限大（5000）
- 在线用户均可参与聊天，无需申请加入群聊，随时加入，随时退出
- 无固定成员列表，成员之间可能是无好友关系的陌生人
- 离线后不需要收到消息推送

### 普通对话

玩家间的单聊、私聊 或者 群聊都属于普通对话，只不过单聊的成员（members）人数为2，群聊成员人数则大于 2。

- 有人数限制，一个群聊中最大支持 500 个成员
- 可查成员列表、成员在线状态，关注成员信息
- 可查历史消息记录
- 允许增加、删除成员
- 成员离线状态下，可以收到消息推送通知，且上线后会进行消息同步


### 临时对话

类似组队聊天，副本内的聊天

- 不需要保存聊天记录，不需要查询历史消息
- 玩家若突然离线，无需发离线消息推送
-「房间」具有一次性，游戏结束「房间」即消失
- 聊天参与的人数较少（最多 8 人组队）


## 消息同步实现

聊天室记录每条消息并打上唯一ID（自增），保留一段时间或一定数目的消息。可能用户半月没有登陆，之前的消息已经
被丢弃，对于游戏聊天系统来看影响不大。用户身上记录每个聊天已读的最大ID。

### 聊天室类型 
加入聊天室，将聊天室ID加入到用户的聊天室列表。
如果用户不在线，加入动作追加到待发送队列，待玩家上线后通知。移除聊天室同理。

聊天消息，根据玩家在不在线，下发消息。

### 普通对话类型
加入聊天室，将聊天室ID加入到用户的聊天室列表。
如果用户不在线，加入动作追加到待发送队列，待玩家上线后通知。移除聊天室同理。

聊天消息，在用户身上记录已读消息序列号，玩家上线时与聊天室的当前信息ID做比较，下发未读消息。